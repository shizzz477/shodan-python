{"body": "<div class=\"section\" id=\"collecting-summary-information-using-facets\">\n<h1>Collecting Summary Information using Facets<a class=\"headerlink\" href=\"#collecting-summary-information-using-facets\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>A powerful ability of the Shodan API is to get summary information on a variety of properties. For example,\nif you wanted to learn which countries have the most Apache servers then you would use facets. If you wanted\nto figure out which version of nginx is most popular, you would use facets. Or if you wanted to see what the\nuptime distribution is for Microsoft-IIS servers then you would use facets.</p>\n<p>The following script shows how to use the <cite>shodan.Shodan.count()</cite> method to search Shodan without returning\nany results as well as asking the API to return faceted information on the organization, domain, port, ASN\nand country.</p>\n<div class=\"highlight-python\"><div class=\"highlight\"><pre><span></span><span class=\"ch\">#!/usr/bin/env python</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\"># query-summary.py</span>\n<span class=\"c1\"># Search Shodan and print summary information for the query.</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\"># Author: achillean</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">shodan</span>\n<span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n\n<span class=\"c1\"># Configuration</span>\n<span class=\"n\">API_KEY</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;YOUR API KEY&#39;</span>\n\n<span class=\"c1\"># The list of properties we want summary information on</span>\n<span class=\"n\">FACETS</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n    <span class=\"s1\">&#39;org&#39;</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;domain&#39;</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;port&#39;</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;asn&#39;</span><span class=\"p\">,</span>\n\n    <span class=\"c1\"># We only care about the top 5 countries, this is how we let Shodan know to return 5 instead of the</span>\n    <span class=\"c1\"># default 10 for a facet. If you want to see more than 10, you could do (&#39;country&#39;, 1000) for example</span>\n    <span class=\"c1\"># to see the top 1,000 countries for a search query.</span>\n    <span class=\"p\">(</span><span class=\"s1\">&#39;country&#39;</span><span class=\"p\">,</span> <span class=\"mi\">5</span><span class=\"p\">),</span>\n<span class=\"p\">]</span>\n\n<span class=\"n\">FACET_TITLES</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"s1\">&#39;org&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;Top 10 Organizations&#39;</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;domain&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;Top 10 Domains&#39;</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;port&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;Top 10 Ports&#39;</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;asn&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;Top 10 Autonomous Systems&#39;</span><span class=\"p\">,</span>\n    <span class=\"s1\">&#39;country&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;Top 5 Countries&#39;</span><span class=\"p\">,</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\"># Input validation</span>\n<span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">argv</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">1</span><span class=\"p\">:</span>\n    <span class=\"k\">print</span> <span class=\"s1\">&#39;Usage: </span><span class=\"si\">%s</span><span class=\"s1\"> &lt;search query&gt;&#39;</span> <span class=\"o\">%</span> <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">argv</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n<span class=\"k\">try</span><span class=\"p\">:</span>\n    <span class=\"c1\"># Setup the api</span>\n    <span class=\"n\">api</span> <span class=\"o\">=</span> <span class=\"n\">shodan</span><span class=\"o\">.</span><span class=\"n\">Shodan</span><span class=\"p\">(</span><span class=\"n\">API_KEY</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># Generate a query string out of the command-line arguments</span>\n    <span class=\"n\">query</span> <span class=\"o\">=</span> <span class=\"s1\">&#39; &#39;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">argv</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">:])</span>\n\n    <span class=\"c1\"># Use the count() method because it doesn&#39;t return results and doesn&#39;t require a paid API plan</span>\n    <span class=\"c1\"># And it also runs faster than doing a search().</span>\n    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">api</span><span class=\"o\">.</span><span class=\"n\">count</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"p\">,</span> <span class=\"n\">facets</span><span class=\"o\">=</span><span class=\"n\">FACETS</span><span class=\"p\">)</span>\n\n    <span class=\"k\">print</span> <span class=\"s1\">&#39;Shodan Summary Information&#39;</span>\n    <span class=\"k\">print</span> <span class=\"s1\">&#39;Query: </span><span class=\"si\">%s</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"n\">query</span>\n    <span class=\"k\">print</span> <span class=\"s1\">&#39;Total Results: </span><span class=\"si\">%s</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"s1\">&#39;total&#39;</span><span class=\"p\">]</span>\n\n    <span class=\"c1\"># Print the summary info from the facets</span>\n    <span class=\"k\">for</span> <span class=\"n\">facet</span> <span class=\"ow\">in</span> <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"s1\">&#39;facets&#39;</span><span class=\"p\">]:</span>\n        <span class=\"k\">print</span> <span class=\"n\">FACET_TITLES</span><span class=\"p\">[</span><span class=\"n\">facet</span><span class=\"p\">]</span>\n\n        <span class=\"k\">for</span> <span class=\"n\">term</span> <span class=\"ow\">in</span> <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"s1\">&#39;facets&#39;</span><span class=\"p\">][</span><span class=\"n\">facet</span><span class=\"p\">]:</span>\n            <span class=\"k\">print</span> <span class=\"s1\">&#39;</span><span class=\"si\">%s</span><span class=\"s1\">: </span><span class=\"si\">%s</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">term</span><span class=\"p\">[</span><span class=\"s1\">&#39;value&#39;</span><span class=\"p\">],</span> <span class=\"n\">term</span><span class=\"p\">[</span><span class=\"s1\">&#39;count&#39;</span><span class=\"p\">])</span>\n\n        <span class=\"c1\"># Print an empty line between summary info</span>\n        <span class=\"k\">print</span> <span class=\"s1\">&#39;&#39;</span>\n\n<span class=\"k\">except</span> <span class=\"ne\">Exception</span><span class=\"p\">,</span> <span class=\"n\">e</span><span class=\"p\">:</span>\n    <span class=\"k\">print</span> <span class=\"s1\">&#39;Error: </span><span class=\"si\">%s</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"n\">e</span>\n    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n<span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">Sample Output</span>\n<span class=\"sd\">=============</span>\n\n<span class=\"sd\">./query-summary.py apache</span>\n<span class=\"sd\">Shodan Summary Information</span>\n<span class=\"sd\">Query: apache</span>\n<span class=\"sd\">Total Results: 34612043</span>\n\n<span class=\"sd\">Top 10 Organizations</span>\n<span class=\"sd\">Amazon.com: 808061</span>\n<span class=\"sd\">Ecommerce Corporation: 788704</span>\n<span class=\"sd\">Verio Web Hosting: 760112</span>\n<span class=\"sd\">Unified Layer: 627827</span>\n<span class=\"sd\">GoDaddy.com, LLC: 567004</span>\n\n<span class=\"sd\">Top 10 Domains</span>\n<span class=\"sd\">secureserver.net: 562047</span>\n<span class=\"sd\">unifiedlayer.com: 494399</span>\n<span class=\"sd\">t-ipconnect.de: 385792</span>\n<span class=\"sd\">netart.pl: 194817</span>\n<span class=\"sd\">wanadoo.fr: 151925</span>\n\n<span class=\"sd\">Top 10 Ports</span>\n<span class=\"sd\">80: 24118703</span>\n<span class=\"sd\">443: 8330932</span>\n<span class=\"sd\">8080: 1479050</span>\n<span class=\"sd\">81: 359025</span>\n<span class=\"sd\">8443: 231441</span>\n\n<span class=\"sd\">Top 10 Autonomous Systems</span>\n<span class=\"sd\">as32392: 580002</span>\n<span class=\"sd\">as2914: 465786</span>\n<span class=\"sd\">as26496: 414998</span>\n<span class=\"sd\">as48030: 332000</span>\n<span class=\"sd\">as8560: 255774</span>\n\n<span class=\"sd\">Top 5 Countries</span>\n<span class=\"sd\">US: 13227366</span>\n<span class=\"sd\">DE: 2900530</span>\n<span class=\"sd\">JP: 2014506</span>\n<span class=\"sd\">CN: 1722048</span>\n<span class=\"sd\">GB: 1209938</span>\n<span class=\"sd\">&quot;&quot;&quot;</span>\n</pre></div>\n</div>\n</div>\n", "alabaster_version": "0.7.10", "display_toc": false, "title": "Collecting Summary Information using Facets", "sourcename": "examples/query-summary.rst.txt", "customsidebar": null, "metatags": "", "current_page_name": "examples/query-summary", "next": {"link": "../cert-stream/", "title": "Access SSL certificates in Real-Time"}, "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["examples/cert-stream", "Access SSL certificates in Real-Time", "N", "next"], ["examples/basic-search", "Basic Shodan Search", "P", "previous"]], "meta": {}, "parents": [], "sidebars": null, "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Collecting Summary Information using Facets</a></li>\n</ul>\n", "prev": {"link": "../basic-search/", "title": "Basic Shodan Search"}, "page_source_suffix": ".rst"}